<!DOCTYPE html>
<html lang="en">

<head>
    <title>Shift Rosterer</title>
    <meta charset="utf-8">
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js">
    </script>
    <![endif]-->
    <style>
    body {
        font-family: Verdana, sans-serif;
        font-size: 0.8em;
    }
    
    header,
    nav,
    section,
    article,
    footer {
        border: 1px solid grey;
        margin: 5px;
        padding: 8px;
    }
    
    nav ul {
        margin: 0;
        padding: 0;
    }
    
    nav ul li {
        display: inline;
        margin: 5px;
    }
    </style>
</head>

<body>
    <header>
        <h1>Ops Shift Rosterer</h1>
    </header>
    <form>
        <button id="default">Everyone's Here!</button>
    </form>
    <div id="container"></div>
    <!-- <script src="https://code.jquery.com/jquery-1.12.3.min.js" integrity="sha256-aaODHAgvwQW1bFOGXMeX+pC4PZIPsvn2h1sArYOhgXQ=" crossorigin="anonymous"></script> -->
    <script>
    window.jQuery || document.write('<script src="js/jquery-1.12.3.min.js">\x3C/script>')
    </script>
    <script src="js/main.js"></script>
    <script type="text/javascript">
    (function() {
        $.when(opsList()).then(function(opsArray) {
            var form = [];

            form.push('<div><input id="operator0" name="operator0" type="text" value="' + opsArray[0] + '"></input><input id="opCC0" name="crew_chief" type="radio" checked="checked"><label for="opCC0">CC</label></div>');

            for (var i = 1; i < opsArray.length; i++) {
                form.push('<div><input id="operator' + i + '" name="operator' + i + '" type="text" value="' + opsArray[i] + '"></input><input id="opCC' + i + '" name="crew_chief" type="radio"><label for="opCC' + i + '">CC</label></div>');
            }

            form.unshift('<form id="filled">');
            form.push("</form>");
            form.push('<button id="submit">Submit</button>');

            $("#container").html(form.join(''));
        });
    })();
    $("#default").click(function() {
        $.when(makePost()).done(function() {
            alert("Successfully POSTed!");
        });
        return false;
    });
    $("#container").on('click', '#submit', function() {
        var form = $('#filled :input'),
            shiftTitle = "Owl+ Shift Roster", //shiftTitle(),
            postArray = [];

        for (var i = 0; i < form.length; i+=2) {
            postArray.push(form[i].value);
        }

        for (var i = 1; i < form.length; i+=2) {
            if (form[i].checked) {
                // Move crew chief to index 1 in array
                postArray.splice(1, 0, postArray.splice(form[i].id.split('')[-1], 1)[0]);
            }
        }

        postArray.unshift(shiftTitle);

        $.when(makePost(postArray)).then(function() {
            alert("Successfully submitted!");
        });
        return false;
    });
    </script>
</body>

</html>
